<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MultiFileServerPlace.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Emissary</a> &gt; <a href="index.source.html" class="el_package">emissary.place</a> &gt; <span class="el_source">MultiFileServerPlace.java</span></div><h1>MultiFileServerPlace.java</h1><pre class="source lang-java linenums">package emissary.place;

import emissary.core.IBaseDataObject;
import emissary.core.IBaseDataObjectHelper;
import emissary.pickup.PickUpPlace;
import emissary.util.DataUtil;
import emissary.util.TypeEngine;

import jakarta.annotation.Nullable;

import java.io.IOException;
import java.io.InputStream;
import java.util.List;
import java.util.Set;

/**
 * A hybrid of the MultiFileServerPlace and the FilePickupPlace. Knows how to sprout agents using the MoveSpool
 */
public abstract class MultiFileServerPlace extends PickUpPlace implements IMultiFileServerPlace {
    protected TypeEngine typeEngine;
    protected Set&lt;?&gt; nonPropagatingMetadataValues;

    public MultiFileServerPlace() throws IOException {
<span class="nc" id="L24">        super();</span>
<span class="nc" id="L25">        configureAbstractPlace();</span>
<span class="nc" id="L26">    }</span>

    public MultiFileServerPlace(String configInfo, String dir, String placeLoc) throws IOException {
<span class="nc" id="L29">        super(configInfo, dir, placeLoc);</span>
<span class="nc" id="L30">        configureAbstractPlace();</span>
<span class="nc" id="L31">    }</span>


    public MultiFileServerPlace(String configInfo, String placeLoc) throws IOException {
<span class="nc" id="L35">        super(configInfo, placeLoc);</span>
<span class="nc" id="L36">        configureAbstractPlace();</span>
<span class="nc" id="L37">    }</span>

    public MultiFileServerPlace(InputStream configStream, String theDir, String thePlaceLocation) throws IOException {
<span class="nc" id="L40">        super(configStream, theDir, thePlaceLocation);</span>
<span class="nc" id="L41">        configureAbstractPlace();</span>
<span class="nc" id="L42">    }</span>

    protected MultiFileServerPlace(InputStream configStream) throws IOException {
<span class="fc" id="L45">        super(configStream);</span>
<span class="fc" id="L46">        configureAbstractPlace();</span>
<span class="fc" id="L47">    }</span>

    public MultiFileServerPlace(InputStream configStream, String thePlaceLocation) throws IOException {
<span class="fc" id="L50">        super(configStream, thePlaceLocation);</span>
<span class="fc" id="L51">        configureAbstractPlace();</span>
<span class="fc" id="L52">    }</span>

    /**
     * Setup base configuration items related to attachment processing
     * &lt;ul&gt;
     * &lt;li&gt;NON_PROPAGATING_METADATA: items to skip when copying&lt;/li&gt;
     * &lt;/ul&gt;
     */
    private void configureAbstractPlace() {
<span class="fc" id="L61">        typeEngine = new TypeEngine(configG);</span>
<span class="fc" id="L62">        nonPropagatingMetadataValues = configG.findEntriesAsSet(&quot;NON_PROPAGATING_METADATA&quot;);</span>
<span class="fc" id="L63">    }</span>

    /**
     * Setup place specific configuration information
     * 
     * @throws IOException when there is an error loading a configuration
     */
    protected abstract void configurePlace() throws IOException;

    /**
     * Validate that we should process this data. Will reject null data or empty objects. Generally, all
     * MultiFileServerPlaces should invoke this method before executing {@link #process(IBaseDataObject)} or
     * {@link #processHeavyDuty(IBaseDataObject)}. Override if your Place wants to do more validation before bothering to
     * process a payload.
     * 
     * @param d payload to validate
     * @return true if d is not null and not empty
     */
    public boolean shouldProcess(IBaseDataObject d) {
<span class="fc" id="L82">        return DataUtil.isNotEmpty(d);</span>
    }

    /**
     * Used to propagate needed parent information to all children in the list without nullifying the child fileType
     * 
     * @param parent the source of parameters to be copied
     * @param children the destination for parameters to be copied
     */
    protected void addParentInformation(IBaseDataObject parent, List&lt;IBaseDataObject&gt; children) {
<span class="fc" id="L92">        IBaseDataObjectHelper.addParentInformationToChildren(parent, children, false, alwaysCopyMetadataVals, myKey, kff);</span>
<span class="fc" id="L93">    }</span>

    /**
     * Used to propagate needed parent information to all children in the list
     * 
     * @param parent the source of parameters to be copied
     * @param children the destination for parameters to be copied
     * @param nullifyFileType if true the child fileType is nullified after the copy
     */
    protected void addParentInformation(IBaseDataObject parent, @Nullable List&lt;IBaseDataObject&gt; children, boolean nullifyFileType) {
<span class="nc" id="L103">        IBaseDataObjectHelper.addParentInformationToChildren(parent, children, nullifyFileType, alwaysCopyMetadataVals, myKey, kff);</span>
<span class="nc" id="L104">    }</span>

    /**
     * Used to propagate needed parent information to a sprouted child without nullifying fileType
     * 
     * @param parent the source of parameters to be copied
     * @param child the destination for parameters to be copied
     */
    protected void addParentInformation(IBaseDataObject parent, IBaseDataObject child) {
<span class="nc" id="L113">        IBaseDataObjectHelper.addParentInformationToChild(parent, child, false, alwaysCopyMetadataVals, myKey, kff);</span>
<span class="nc" id="L114">    }</span>

    /**
     * Used to propagate needed parent information to a sprouted child
     * 
     * @param parent the source of parameters to be copied
     * @param child the destination for parameters to be copied
     * @param nullifyFileType if true the child fileType is nullified after the copy
     */
    protected void addParentInformation(@Nullable IBaseDataObject parent, @Nullable IBaseDataObject child, boolean nullifyFileType) {
<span class="nc" id="L124">        IBaseDataObjectHelper.addParentInformationToChild(parent, child, nullifyFileType, alwaysCopyMetadataVals, myKey, kff);</span>
<span class="nc" id="L125">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>